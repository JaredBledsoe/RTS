<html>

<head>
    <link href="https://fonts.googleapis.com/css?family=Shrikhand" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Lato:300,400,700' rel='stylesheet' type='text/css'>
    <style>
    body {
        margin: 0;
        user-select: none;
        overflow: hidden;
        background-image: url('https://i.pinimg.com/736x/2e/f4/71/2ef471c9d20d2a040816906288f92992--floor-texture-rock-texture.jpg');
        background-repeat: repeat;
        background-size: 20%;
    }

    p {
        margin: 0;
    }

    .hide {
        display: none;
    }

    .show {
        display: initial;
    }

    #shadow {
        position: absolute;
        width: 100%;
        height: 100%;
        box-shadow: inset 0px 0px 150px 50px rgb(0, 0, 0);
    }

    canvas {
        box-shadow: inset 0px 0px 500px 150px rgb(0, 0, 0);
    }

    img {
        position: absolute;
        display: none;
    }

    #hud {
        position: absolute;
        left: 50%;
        transform: translate(-50%, 0);
        height: 50px;
        bottom: 5%;
        white-space: nowrap;
    }

    #controls {
        width: 500px;
        height: 500px;
        position: absolute;
        background-image: url('../public/images/controls.png');
        top: 5px;
        left: 5px;
    }

    .slot {
        width: 80px;
        height: 80px;
        display: inline-block;
        box-shadow: inset 0px 0px 15px 5px rgba(0, 0, 0, 0.75), 0px 0px 30px 0px rgba(0, 0, 0, 0.75);
        background-color: rgba(0, 0, 0, .25);
        font-size: 20px;
        color: white;
    }

    .slotValue {
        text-shadow: 0 0 15px rgba(0, 0, 0, .75);
        margin: 0 5px;
        font-family: 'Shrikhand', cursive;
    }

    .select {
        background-color: rgba(255, 255, 255, .25);
    }

    #buildMenu,
    #chatInstruction {
        position: absolute;
        z-index: 10;
        top: 50%;
        left: 50%;
        transform: translate(-50%, 0);
        font-family: 'Shrikhand', cursive;
        font-weight: bold;
        font-size: 15px;
    }

    .rock1,
    .rock2,
    .rock3,
    .rock4,
    .buildSection {
        text-align: center;
        position: absolute;
        width: 50px;
        height: 50px;
        background-repeat: no-repeat;
        background-position: center;
        background-size: 40px 40px;
        -webkit-text-stroke-width: 1px;
        -webkit-text-stroke-color: black;
        vertical-align: middle;
    }
    /*    .buildTitle {
        margin-top: 15px !important;
    }
*/

    .canAfford {
        color: #99ff66;
        background-color: #99ff66;
        /*        box-shadow: 0 0 20px 2px #99ff66;
*/
        text-shadow: 0 0 10px #99ff66;
    }

    .cannotAfford {
        color: #ff6666;
        background-color: #ff6666;
        /*        box-shadow: 0 0 20px 2px #ff6666;
*/
        text-shadow: 0 0 10px #ff6666;
    }

    .rock1 {
        width: 100px;
        top: -75px;
        left: -25px;
        background-position: 5px;
        outline: 1px inset black;
    }

    .upgrade .rock1 {
        width: 50px;
        background-color: #ff6666;
    }

    .rock2 {
        height: 99px;
        top: -24px;
        left: 25px;
        background-position: 5px 5px;
        outline: 1px inset black;
    }

    .upgrade .rock3 {
        width: 100px;
    }

    .rock3 {
        width: 99px;
        top: 25px;
        left: -75px;
        background-position: 55px 5px;
        outline: 1px inset black;
    }

    .rock3 .menuImageSection {
        width: 49px;
    }

    .rock4 {
        height: 99px;
        top: -75px;
        left: -75px;
        background-position: 5px 55px;
        text-align: center;
        outline: 1px inset black;
    }

    .upgrade .rock4 {
        height: 99px;
        top: -24px;
        left: -75px;
        background-position: 5px 5px;
        outline: 1px inset black;
    }

    #chatInstruction {
        margin-top: 25px;
    }

    #chatInstruction p {
        color: white;
        margin: 0;
    }

    #chatPreview {
        white-space: nowrap;
        font-size: 25px;
        position: absolute;
        background-color: rgba(0, 0, 0, .5);
        width: auto;
        height: auto;
        left: 50%;
        top: -76px;
        transform: translate(-50%, 0);
    }

    .buildSection {
        position: absolute;
    }

    .buildMain {
        background-color: gold;
        color: gold;
        box-shadow: 0 0 20px 2px gold;
        text-shadow: 0 0 10px gold;
    }

    .menuImageSection {
        width: 50px;
        height: 50px;
        background-repeat: no-repeat;
        background-position: 9px;
        float: left;
    }

    .menuTextSection {
        width: 50px;
        height: 50px;
        float: left;
        display: table;
    }

    .buildTitle {
        display: table-cell;
        vertical-align: middle;
    }
    </style>
</head>

<body>
    <div id="shadow"></div>
    <img id="head" src="http://i1341.photobucket.com/albums/o751/Joacko_/Zombieface_zpscd3b62eb.png">
    <img class="rock1" src="http://rtstextures.bitballoon.com/rock1.jpg">
    <img class="rock2" src="http://rtstextures.bitballoon.com/rock2.jpg">
    <img class="rock3" src="http://rtstextures.bitballoon.com/rock3.jpg">
    <img class="rock4" src="http://rtstextures.bitballoon.com/rock4.jpg">
    <img class="rock5" src="http://rtstextures.bitballoon.com/lava.jpg">
    <img class="wall1" src="http://rtstextures.bitballoon.com/rock5.jpg">
    <img class="wall2" src="http://rtstextures.bitballoon.com/rock6.jpg">
    <img class="wall3" src="http://rtstextures.bitballoon.com/rock7.jpg">
    <img class="wall4" src="http://rtstextures.bitballoon.com/rock8.jpg">
    <img id="crack1" src="http://www.textures4photoshop.com/tex/thumbs/crack-texture-png-free-thumb22.png">
    <img id="crack2" src="http://www.textures4photoshop.com/tex/thumbs/cracked-wall-PNG-texture-thumb24.png">
    <img id="crack3" src="http://www.textures4photoshop.com/tex/thumbs/broken-mirror-with-glass-shards-png-608.png">
    <canvas id="game"></canvas>
    <div id="hud">
        <div class="slot" style="background-image: url('http://rtstextures.bitballoon.com/rock1.jpg')">
            <p class="slotValue">0</p>
        </div>
        <div class="slot" style="background-image: url('http://rtstextures.bitballoon.com/rock2.jpg')">
            <p class="slotValue">0</p>
        </div>
        <div class="slot" style="background-image: url('http://rtstextures.bitballoon.com/rock3.jpg')">
            <p class="slotValue">0</p>
        </div>
        <div class="slot" style="background-image: url('http://rtstextures.bitballoon.com/rock4.jpg')">
            <p class="slotValue">0</p>
        </div>
    </div>
    <img src="http://rtstextures.bitballoon.com/rock5.jpg" id="test">
    <div id="buildMenu" class="hide">
        <div class="buildSection" class="hide">
            <div class="rock1 buildMain">
                <img src="http://rtstextures.bitballoon.com/rock5.jpg">
                <div class="menuImageSection" style="background-image: url('http://rtstextures.bitballoon.com/rock5.jpg')"></div>
                <div class="menuTextSection">
                    <p class="buildTitle">Walls</p>
                </div>
            </div>
            <div class="rock2 buildMain">
                <div class="menuImageSection" style="background-image: url('http://rtstextures.bitballoon.com/rock5.jpg')"></div>
                <div class="menuTextSection">
                    <p class="buildTitle">SOON</p>
                </div>
            </div>
            <div class="rock3 buildMain">
                <div class="menuTextSection">
                    <p class="buildTitle">SOON</p>
                </div>
                <div class="menuImageSection" style="background-image: url('http://rtstextures.bitballoon.com/rock5.jpg')"></div>
            </div>
            <div class="rock4 buildMain">
                <div class="menuTextSection">
                    <p class="buildTitle">SOON</p>
                </div>
                <div class="menuImageSection" style="background-image: url('http://rtstextures.bitballoon.com/rock5.jpg')"></div>
            </div>
        </div>
        <div class="buildSection">
            <div class="rock1">
                <div class="menuImageSection" style="background-image: url('http://rtstextures.bitballoon.com/rock5.jpg')"></div>
                <div class="menuTextSection">
                    <p class="buildTitle">10
                        <br> DIRT</p>
                </div>
            </div>
            <div class="rock2">
                <div class="menuImageSection" style="background-image: url('http://rtstextures.bitballoon.com/rock6.jpg')"></div>
                <div class="menuTextSection">
                    <p class="buildTitle">5
                        <br> ROCK</p>
                </div>
            </div>
            <div class="rock3">
                <div class="menuTextSection">
                    <p class="buildTitle">3
                        <br> GOLD</p>
                </div>
                <div class="menuImageSection" style="background-image: url('http://rtstextures.bitballoon.com/rock7.jpg')"></div>
            </div>
            <div class="rock4">
                <div class="menuTextSection">
                    <p class="buildTitle">1
                        <br> DIAM</p>
                </div>
                <div class="menuImageSection" style="background-image: url('http://rtstextures.bitballoon.com/rock8.jpg')"></div>
            </div>
        </div>
        <div class="buildSection">
            <div class="rock1">
                <p class="stoneAmount">10</p>
                <p>DIRT2</p>
            </div>
            <div class="rock2">
                <p class="stoneAmount">5</p>
                <p>STONE</p>
            </div>
            <div class="rock3">
                <p class="stoneAmount">3</p>
                <p>GOLD</p>
            </div>
            <div class="rock4">
                <p class="stoneAmount">1</p>
                <p>DIAM</p>
            </div>
        </div>
        <div class="buildSection">
            <div class="rock1">
                <p class="stoneAmount">10</p>
                <p>DIRT3</p>
            </div>
            <div class="rock2">
                <p class="stoneAmount">5</p>
                <p>STONE</p>
            </div>
            <div class="rock3">
                <p class="stoneAmount">3</p>
                <p>GOLD</p>
            </div>
            <div class="rock4">
                <p class="stoneAmount">1</p>
                <p>DIAM</p>
            </div>
        </div>
        <div class="buildSection">
            <div class="rock1">
                <p class="stoneAmount">10</p>
                <p>DIRT4</p>
            </div>
            <div class="rock2">
                <p class="stoneAmount">5</p>
                <p>STONE</p>
            </div>
            <div class="rock3">
                <p class="stoneAmount">3</p>
                <p>GOLD</p>
            </div>
            <div class="rock4">
                <p class="stoneAmount">1</p>
                <p>DIAM</p>
            </div>
        </div>
        <div class="buildSection upgrade">
            <div class="rock1 cannotAfford">
                <div class="menuTextSection">
                    <p class="buildTitle" id="sell">SELL</p>
                </div>
            </div>
            <div class="rock3 canAfford">
                <div class="menuTextSection">
                    <p class="buildTitle" id="upgradeText">5
                        <br> ROCK</p>
                </div>
                <div id="upgrageImg" class="menuImageSection"></div>
            </div>
        </div>
    </div>
    <div id="chatInstruction" class="hide">
        <p>ENTER = Send</p>
        <p>ESC = Close</p>
        <p id="chatPreview"></p>
    </div>
    <script>
    var HOST = location.origin.replace(/^http/, 'ws');

    //Online
    var ws = new WebSocket(HOST);
    console.log('%c Please report any bugs/exploits to: jared.bledsoe@icloud.com', 'color: red; font-size: 150%; background-color: #e6e6e6; font-weight: bold; padding: 10px; border: 2px dashed red; border-radius: 25px;')

    var canvas = document.getElementById('game');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    var ctx = canvas.getContext('2d');

    window.addEventListener("resize", function() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    });

    var keyStates = [];
    var grids = [];
    var player;
    var arrow = document.getElementById('arrow');
    var head = document.getElementById('head');

    var rocks = [document.getElementsByClassName('rock1')[0], document.getElementsByClassName('rock2')[0], document.getElementsByClassName('rock3')[0], document.getElementsByClassName('rock4')[0], document.getElementsByClassName('rock5')[0], document.getElementsByClassName('wall1')[0], document.getElementsByClassName('wall2')[0], document.getElementsByClassName('wall3')[0], document.getElementsByClassName('wall4')[0]];
    var slots = [document.getElementsByClassName('rock1')[2], document.getElementsByClassName('rock2')[2], document.getElementsByClassName('rock3')[2], document.getElementsByClassName('rock4')[2]];
    var slotCosts = [10, 5, 3, 1];

    var brick1 = document.getElementById('brick1');

    var crack1 = document.getElementById('crack1');
    var crack2 = document.getElementById('crack2');
    var crack3 = document.getElementById('crack3');

    var characters = /^[_A-z0-9]*((-|\s)*[_A-z0-9])*$/g;



    ws.onmessage = function(e) {
        var message = JSON.parse(e.data);
        if (message.type == 'gameUpdate') {
            player.x = message.player[0];
            player.y = message.player[1];
            player.gridId = message.player[2];
            player.smoothMoving = message.player[3];
            player.stones = message.player[4];

            for (var i = 0; i < message.updatedGrids.length; i++) {
                grids[message.updatedGrids[i].gridId] = message.updatedGrids[i];
            }

            if (player.readyDraw === true) {
                player.control();
                drawTimer();

                for (var i = 0; i < message.players.length; i++) {
                    if (message.players[i][2]) {
                        ctx.textAlign = 'center';
                        ctx.font = '25px Shrikhand';
                        ctx.fillStyle = 'white';
                        ctx.fillText(message.players[i][2], message.players[i][0] + 25, message.players[i][1]);
                    }
                    ctx.drawImage(head, message.players[i][0] + 7, message.players[i][1] + 7, 36, 36);
                }
            }
        } else if (message.type == 'closeHUD') {
            player.build('toggle');
        }
        //Player just joined
        else if (message.type == 'initPlayer') {
            player = new Players(message.player.x, message.player.y, message.player.id, message.player.move, message.player.gridId);
            grids = message.grids;

            ws.send(JSON.stringify({
                type: 'initPlayer',
                info: player,
                id: player.id
            }));
        }
    }




    function Players(x, y, id, move, gridId) {
        this.x = x;
        this.y = y;
        this.id = id;
        this.move = [-1, 0];
        this.gridId = gridId;
        this.smoothMoving = false;
        this.updated = false;
        this.building = false;
        this.chatting = false;
        this.message = '';
        this.stones = [0, 0, 0, 0];
        this.viewStartGrid = 0;
        this.viewEndGrid = 0;
        this.readyDraw = true;
        this.subHUD = 0;
        this.readyBuild = false;

        this.control = function() {

            if (!this.building && !this.chatting) {
                this.move[0] = keyStates[38] || keyStates[87] ? 0 :
                    keyStates[39] || keyStates[68] ? 1 :
                    keyStates[40] || keyStates[83] ? 2 :
                    keyStates[37] || keyStates[65] ? 3 : -1;
            }

            if (this.updated === true) {
                this.updated = false;
                ws.send(JSON.stringify({
                    type: 'playerUpdate',
                    move: this.move,
                    id: this.id
                }));
            }

            this.activeHUD();
        };
        this.activeHUD = function() {
            this.viewStartGrid = this.gridId - Math.trunc(canvas.width) - Math.trunc(canvas.height / 100) - 100 > 0 ? this.viewStartGrid = this.gridId - Math.trunc(canvas.width) - Math.trunc(canvas.height / 100) - 100 : 0;
            this.viewEndGrid = this.gridId + Math.trunc(canvas.height) + Math.trunc(canvas.height / 100) + 100 < grids.length ? this.viewEndGrid = this.gridId + Math.trunc(canvas.width) + Math.trunc(canvas.height / 100) + 100 : 10000;

            //Bottom bar
            if (document.getElementsByClassName('slotValue')[0].innerHTML != this.stones[0]) {
                document.getElementsByClassName('slotValue')[0].innerHTML = this.stones[0];
            }
            if (document.getElementsByClassName('slotValue')[1].innerHTML != this.stones[1]) {
                document.getElementsByClassName('slotValue')[1].innerHTML = this.stones[1]
            }
            if (document.getElementsByClassName('slotValue')[2].innerHTML != this.stones[2]) {
                document.getElementsByClassName('slotValue')[2].innerHTML = this.stones[2];
            }
            if (document.getElementsByClassName('slotValue')[3].innerHTML != this.stones[3]) {
                document.getElementsByClassName('slotValue')[3].innerHTML = this.stones[3];
            }

            //Chat instructions
            if (this.chatting === true && document.getElementById('chatInstruction').classList.contains('hide')) {
                document.getElementById('chatInstruction').classList.add('show');
                document.getElementById('chatInstruction').classList.remove('hide');
            } else if (this.chatting === false && document.getElementById('chatInstruction').classList.contains('show')) {
                document.getElementById('chatInstruction').classList.add('hide');
                document.getElementById('chatInstruction').classList.remove('show');
            }
            if (this.chatting === true) {
                document.getElementById('chatPreview').innerHTML = this.message;
            }
        };
        this.build = function(e) {
            if (this.smoothMoving === false) {
                if (e == 'toggle') {
                    this.subHUD = 0;
                    if (document.getElementById('buildMenu').classList.contains('hide')) {
                        this.building = true;
                        this.move[0] = -1;
                        document.getElementById('buildMenu').classList.add('show');
                        document.getElementById('buildMenu').classList.remove('hide');
                    } else if (document.getElementById('buildMenu').classList.contains('show')) {
                        document.getElementById('buildMenu').classList.add('hide');
                        document.getElementById('buildMenu').classList.remove('show');
                        this.building = false;
                        this.move[1] = 0;
                    }
                    keyStates[37] = false;
                    keyStates[38] = false;
                    keyStates[39] = false;
                    keyStates[40] = false;
                    keyStates[87] = false;
                    keyStates[83] = false;
                    keyStates[65] = false;
                    keyStates[68] = false;

                    this.passiveHUD();
                } else if (typeof(e) == 'number') {
                    this.move[1] = e;
                    ws.send(JSON.stringify({
                        type: 'build',
                        id: this.id,
                        build: e
                    }));
                }
            }
        };
        this.chat = function() {
            if (this.chatting === false) {
                this.chatting = true;
            } else if (this.chatting === true) {
                ws.send(JSON.stringify({
                    type: 'chat',
                    id: this.id,
                    info: this.message
                }));
                this.message = '';
                this.chatting = false;
            }
        };
        this.passiveHUD = function() {
            if (this.building == true) {
                document.getElementById('buildMenu').classList.add('show');

                if (this.subHUD == 0) {
                    if (grids[this.gridId].rock < 1000) {
                        this.subHUD = keyStates[87] || keyStates[38] ? 1 : keyStates[68] || keyStates[39] ? 2 : keyStates[83] || keyStates[40] ? 3 : keyStates[65] || keyStates[37] ? 4 : 0;
                    } else {
                        this.subHUD = 5;
                    }
                } else {
                    var buildDir = keyStates[38] || keyStates[87] ? 0 :
                        keyStates[39] || keyStates[68] ? 1 :
                        keyStates[40] || keyStates[83] ? 2 :
                        keyStates[37] || keyStates[65] ? 3 : -1;

                    if (buildDir >= 0) {
                        this.build(buildDir);
                    }
                }
                for (var i = 0; i < document.getElementsByClassName('buildSection').length; i++) {
                    document.getElementsByClassName('buildSection')[i].classList.add('hide');
                    document.getElementsByClassName('buildSection')[i].classList.remove('show');
                }
                document.getElementsByClassName('buildSection')[this.subHUD].classList.add('show');
                document.getElementsByClassName('buildSection')[this.subHUD].classList.remove('hide');


                //Build walls
                if (this.subHUD == 1) {
                    for (var i = 0; i < slots.length; i++) {
                        if (this.stones[i] >= slotCosts[i]) {
                            slots[i].classList.add('canAfford');
                            slots[i].classList.remove('cannotAfford');
                        } else {
                            slots[i].classList.add('cannotAfford');
                            slots[i].classList.remove('canAfford');
                        }
                    }
                } else if (this.subHUD == 2) {

                } else if (this.subHUD == 3) {

                } else if (this.subHUD == 4) {

                } else if (this.subHUD == 5) {
                    var cost = grids[player.gridId].rock == 1001 ? 5 :
                        grids[player.gridId].rock == 1002 ? 3 :
                        grids[player.gridId].rock == 1003 ? 1 : 'MAX <br> UPGRADE';

                    var img = cost == 5 ? 'http://rtstextures.bitballoon.com/rock6.jpg)' :
                        cost == 3 ? 'http://rtstextures.bitballoon.com/rock7.jpg)' :
                        cost == 1 ? 'http://rtstextures.bitballoon.com/rock8.jpg)' : 0;
                    document.getElementById('upgrageImg').style.backgroundImage = 'url('.concat(img);

                    var text = cost == 5 ? 'ROCK' :
                        cost == 3 ? 'GOLD' :
                        cost == 1 ? 'DIAM' : '';

                    document.getElementById('upgradeText').innerHTML = cost + '<br>' + text;

                    console.log(img);
                }
            }
        };
    };




    function drawTimer() {
        player.readyDraw = false;
        ctx.clearRect(player.x - canvas.width / 2 + 25, player.y - canvas.height / 2 + 25, canvas.width, canvas.height);

        ctx.setTransform(1, 0, 0, 1, -player.x - 25 + canvas.width / 2, -player.y - 25 + canvas.height / 2);

        for (var i = player.viewStartGrid; i < player.viewEndGrid; i++) {
            var a = i.toString().slice(-2);
            var b = player.gridId.toString().slice(-2);
            //Limit vertival render
            if (b - a >= 0 && b - a <= Math.trunc(canvas.height / 100) || a - b >= 0 && a - b <= Math.trunc(canvas.height / 100)) {
                draw(i);
            }
            if (i + 1 == player.viewEndGrid) {
                player.readyDraw = true;
            }
        }
    }




    function draw(index) {
        //Textured rocks
        if (grids[index].rock) {
            ctx.drawImage(rocks[grids[index].image], grids[index].x, grids[index].y, 50, 50);
            if (grids[index].owner == player.id) {
                ctx.fillStyle = 'rgba(153, 255, 102, .15)';
                ctx.fillRect(grids[index].x, grids[index].y, 50, 50);
            } else if (typeof grids[index].owner === 'number') {
                ctx.fillStyle = 'rgba(255, 102, 102, .15)';
                ctx.fillRect(grids[index].x, grids[index].y, 50, 50);
            }

            if (grids[index].health < 40 && grids[index].health > 0) {
                ctx.fillStyle = '#ff6666';
                ctx.fillRect(grids[index].x + 5, grids[index].y + 22, 40, 8);
                ctx.fillStyle = '#99ff66';
                ctx.fillRect(grids[index].x + 5, grids[index].y + 22, grids[index].health, 8);
            }
        }
        //Player path
        else if (typeof grids[index].owner === 'number' || grids[index].occupied || grids[index].contesting) {
            if (grids[index].owner == player.id) {
                ctx.fillStyle = 'rgba(153, 255, 102, .75)';
            } else if (typeof grids[index].owner === 'number') {
                ctx.fillStyle = 'rgba(255, 102, 102, .75)';
            }
            ctx.fillRect(grids[index].x, grids[index].y, 50, 50);
        }
    }




    //Stop repeat keys
    var oneTimeBuild = false;

    window.addEventListener('keydown', function(e) {
        //Movement
        switch (e.keyCode) {
            case 37:
            case 38:
            case 39:
            case 40:
            case 87:
            case 83:
            case 65:
            case 68:
                keyStates[37] = false;
                keyStates[38] = false;
                keyStates[39] = false;
                keyStates[40] = false;
                keyStates[87] = false;
                keyStates[83] = false;
                keyStates[65] = false;
                keyStates[67] = false;
                keyStates[e.keyCode] = true;
                player.passiveHUD();
        }

        //Chat
        if (e.keyCode == 13 && player.chatting === false) {
            keyStates[e.keyCode] = true;
            player.chat();
        } else if (e.keyCode == 13 && player.chatting === true) {
            player.chat();
        }
        if (player.chatting === true && e.keyCode != 13) {
            if (e.keyCode >= 48 && e.keyCode <= 90 || e.keyCode == 32 || e.keyCode >= 186 && e.keyCode <= 222) {
                if (player.message.length < 45) {
                    player.message += e.key;
                }
            } else if (e.keyCode == 8) {
                player.message = player.message.slice(0, -1);
            }
        }
        //Build menu
        else if (e.keyCode == 32 || e.keyCode == 27) {
            player.build('toggle');
            oneTimeBuild = true;
        }

        player.updated = true;
    });

    window.addEventListener('keyup', function(e) {
        oneTimeBuild = false;
        keyStates[e.keyCode] = false;
        player.updated = true;
    });
    </script>
</body>

</html>
